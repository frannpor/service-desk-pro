# ðŸš€ GuÃ­a de Despliegue - ServiceDesk Pro

## ðŸ› ï¸ Estructura del Proyecto

```
servicedesk-pro/
â”œâ”€â”€ apps/
â”‚   â”œâ”€â”€ backend/
â”‚   â”‚   â”œâ”€â”€ src/
â”‚   â”‚   â”œâ”€â”€ prisma/
â”‚   â”‚   â”œâ”€â”€ Dockerfile
â”‚   â”‚   â”œâ”€â”€ package.json
â”‚   â”‚   â””â”€â”€ .env
â”‚   â””â”€â”€ frontend/
â”‚       â”œâ”€â”€ app/
â”‚       â”œâ”€â”€ components/
â”‚       â”œâ”€â”€ Dockerfile
â”‚       â”œâ”€â”€ package.json
â”‚       â””â”€â”€ .env.local
â”œâ”€â”€ docker-compose.yml
â”œâ”€â”€ .dockerignore
â”œâ”€â”€ .env.example
â””â”€â”€ package.json
```

## ðŸ“¦ ConfiguraciÃ³n de Variables de Entorno

### Backend (`apps/backend/.env`)
```bash
NODE_ENV=development
PORT=3001
DATABASE_URL=postgresql://servicedesk_user:password@localhost:5433/servicedesk_pro_db
JWT_SECRET=xPfFSOIysG3ZiDFUNTZd_MtNicatEV5P-JTXkSjOyJ4
CORS_ORIGIN=http://localhost:3000
```

### Frontend (`apps/frontend/.env.local`)
```bash
NEXT_PUBLIC_API_URL=http://localhost:3001
NEXTAUTH_URL=http://localhost:3000
NEXTAUTH_SECRET=xPfFSOIysG3ZiDFUNTZd_MtNicatEV5P-JTXkSjOyJ4
```

## ðŸš€ Comandos de Despliegue

### Desarrollo Local (sin Docker)

```bash
# 1. Instalar dependencias
npm run install:all

# 2. Levantar solo la base de datos con Docker
docker-compose up postgres -d

# 3. Generar Prisma Client
npm run db:generate

# 4. Aplicar migraciones
npm run db:push

# 5. Ejecutar seeds
npm run db:seed

# 6. Iniciar aplicaciones en desarrollo
npm run dev
```

### ProducciÃ³n con Docker

```bash
# 1. Construir y levantar todos los servicios
docker-compose up --build -d

# 2. Ver logs
docker-compose logs -f

# 3. Ver logs especÃ­ficos
docker-compose logs -f backend
docker-compose logs -f frontend

# 4. Verificar estado
docker-compose ps

# 5. Reiniciar servicios
docker-compose restart backend
docker-compose restart frontend

# 6. Detener servicios
docker-compose down

# 7. Detener y eliminar volÃºmenes (Â¡CUIDADO! Borra la BD)
docker-compose down -v
```

## ðŸ” VerificaciÃ³n de Despliegue

### 1. Verificar Base de Datos
```bash
docker exec -it servicedesk-postgres psql -U servicedesk_user -d servicedesk_pro_db -c "\dt"
```

### 2. Verificar Frontend
```bash
# Visita: http://localhost:3000
```

## ðŸ› Troubleshooting

### Error: "Can't reach database server"
```bash
# Verificar que Postgres estÃ© saludable
docker-compose ps postgres

# Ver logs de Postgres
docker-compose logs postgres

# Reiniciar Postgres
docker-compose restart postgres
```

### Error: "Module not found" en Backend
```bash
# Reconstruir backend
docker-compose build --no-cache backend
docker-compose up -d backend
```

### Error: "Invalid environment variables" en Frontend
```bash
# Verificar que las variables NEXT_PUBLIC_ estÃ©n en build args
docker-compose build --no-cache frontend
docker-compose up -d frontend
```

### Limpiar y Reiniciar Completamente
```bash
# Detener todo
docker-compose down

# Eliminar imÃ¡genes
docker-compose down --rmi all

# Eliminar volÃºmenes
docker-compose down -v

# Reconstruir desde cero
docker-compose build --no-cache
docker-compose up -d
```

## ðŸ”’ Seguridad para ProducciÃ³n

Antes de desplegar en producciÃ³n, cambia:

1. **JWT_SECRET y NEXTAUTH_SECRET**: Genera nuevos valores Ãºnicos
```bash
node -e "console.log(require('crypto').randomBytes(32).toString('base64'))"
```

2. **ContraseÃ±as de Base de Datos**: Usa contraseÃ±as fuertes

3. **CORS_ORIGIN**: Configura el dominio real de producciÃ³n

4. **Variables de Entorno**: Usa archivos `.env` separados o secretos de Docker/Kubernetes

## ðŸ“Š Monitoreo

### Ver uso de recursos
```bash
docker stats
```

### Ver logs en tiempo real
```bash
docker-compose logs -f --tail=100
```

### Backup de Base de Datos
```bash
docker exec servicedesk-postgres pg_dump -U servicedesk_user servicedesk_pro_db > backup.sql
```

### Restaurar Base de Datos
```bash
docker exec -i servicedesk-postgres psql -U servicedesk_user servicedesk_pro_db < backup.sql
```

## ðŸ“ž Soporte

Si encuentras problemas:
1. Revisa los logs con `docker-compose logs -f`
2. Verifica la conectividad de red con `docker network inspect servicedesk-network`
3. AsegÃºrate de que los puertos no estÃ©n ocupados: `lsof -i :3000,3001,5433`